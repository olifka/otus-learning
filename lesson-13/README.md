# OTUS Learning
# Урок 14 "Автоматизация администрирования. Ansible-1"


# Задача 1
Подготовить стенд на Vagrant как минимум с одним сервером. На этом сервере используя Ansible необходимо развернуть nginx со следующими условиями:
- необходимо использовать модуль yum/apt
- конфигурационные файлы должны быть взяты из шаблона jinja2 с перемененными
- после установки nginx должен быть в режиме enabled в systemd
- должен быть использован notify для старта nginx после установки
- сайт должен слушать на нестандартном порту - 8080, для этого использовать переменные в Ansible

Домашнее задание считается принятым, если:
- предоставлен Vagrantfile и готовый playbook/роль ( инструкция по запуску стенда, если посчитаете необходимым )
- после запуска стенда nginx доступен на порту 8080
- при написании playbook/роли соблюдены перечисленные в задании условия
Критерии оценки: Ставим 5 если создан playbook
Ставим 6 если написана роль

# Решение:
Чтобы ansible заработал, после первого запуска VM необходимо добавить публичный ключ виртуалки в known_hosts. Просто выполняем команду ```ssh -p 2222 127.0.0.1``` и на всё соглашаемся. После этого ansible-playbook отрабатывает нормально.

Playbook, написанный по методичке - [nginx.yml](nginx.yml)

Роль, написанная по примеру из интернета - [roles/nginx](role/nginx)
Запуск роли осуществялется с помощью плэйбука [nginx_run_role.yml](nginx_run_role.yml)

Вывод установки nginx через роль:
```
ansible-playbook nginx_run_role.yml

PLAY [nginx] ******************************************************************************************

TASK [Gathering Facts] ******************************************************************************************
ok: [nginx]

TASK [nginx : install nginx] ******************************************************************************************
included: /home/oliferuk/OTUS/otus-learning/lesson-13/roles/nginx/tasks/nginx_install.yml for nginx

TASK [nginx : install yum-utils] ******************************************************************************************
ok: [nginx]

TASK [nginx : add nginx repo] ******************************************************************************************
changed: [nginx]

TASK [nginx : install nginx] ******************************************************************************************
changed: [nginx]

TASK [nginx : configure nginx] ******************************************************************************************
included: /home/oliferuk/OTUS/otus-learning/lesson-13/roles/nginx/tasks/nginx_configure.yml for nginx

TASK [nginx : Create nginx config from template] ******************************************************************************************
changed: [nginx]

RUNNING HANDLER [nginx : start/enable nginx] ******************************************************************************************
changed: [nginx]

RUNNING HANDLER [nginx : restart/enable] ******************************************************************************************
changed: [nginx]

PLAY RECAP ******************************************************************************************
nginx                      : ok=9    changed=5    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```